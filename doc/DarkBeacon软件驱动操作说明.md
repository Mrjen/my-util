# 磁轴68键PC端与设备端通讯协议

**深圳市灰鲨科技有限公司**  
**研发部硬件组（V1.0.0）**

---

## 数据帧结构

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| Byte1~byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7~byteN-5 | byteN-4 | byteN-3~byteN-2 | byteN-1~byteN |

---

## 一、自定义RGB全局灯光（0x21）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x04 | 0x21 | R、G、B | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）设置RGB全局灯光为红灯（0xFF, 0x00, 0x00）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x21, 0xFF, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x5E, 0xC5
```

2）设置RGB全局灯光为蓝灯（0x00, 0x00, 0xFF）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x21, 0x00, 0x00, 0xff, 0xFC, 0x5A, 0xA5, 0x45, 0xe1
```

3）设置RGB全局灯光为黄灯（0xFF, 0xFF, 0x00）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x21, 0xff, 0xff, 0x00, 0xFC, 0x5A, 0xA5, 0x4a, 0xd1
```

4）设置RGB全局灯光为绿灯（0x00, 0xFF, 0x00）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x21, 0x00, 0xff, 0x00, 0xFC, 0x5A, 0xA5, 0x45, 0xc5
```

5）设置RGB全局灯光为紫灯（0xFF, 0x00, 0xFF）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x21, 0xff, 0x00, 0xff, 0xFC, 0x5A, 0xA5, 0x4a, 0xf5
```

6）关闭RGB全局灯光（0x00, 0x00, 0x00）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x21, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x51, 0xd1
```

---

## 二、幻彩灯效（0x24）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x02 | 0x24 | Byte7 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**灯效模式：**

1）波涛汹涌（0x05）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x05, 0xFC, 0x5A, 0xA5, 0xe7, 0x6e
```

2）按键跟随（0x04）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x04, 0xFC, 0x5A, 0xA5, 0x1b, 0x6f
```

3）刀山火海（0x03）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x03, 0xFC, 0x5A, 0xA5, 0x6f, 0x6e
```

4）繁星点点（0x02）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x02, 0xFC, 0x5A, 0xA5, 0x93, 0x6f
```

5）彩虹渐变（0x01）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x01, 0xFC, 0x5A, 0xA5, 0xd7, 0x6f
```

6）用户自定义RGB灯光（0x06）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x06, 0xFC, 0x5A, 0xA5, 0xA3, 0x6E
```

7）波浪（0x07）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x07, 0xFC, 0x5A, 0xA5, 0x5F, 0x6F
```

8）海浪渐变（0x08）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x08, 0xFC, 0x5A, 0xA5, 0x4b, 0x6c
```

9）跟随波浪（0x09）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x09, 0xFC, 0x5A, 0xA5, 0xb7, 0x6d
```

10）大千世界（0x0a）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x0a, 0xFC, 0x5A, 0xA5, 0xf3, 0x6d
```

11）彩虹波动（0x0b）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x0b, 0xFC, 0x5A, 0xA5, 0x0f, 0x6c
```

12）默认灯效（0x0c）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x0c, 0xFC, 0x5A, 0xA5, 0x7b, 0x6d
```

13）彩虹雨（0x0d）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x0d, 0xFC, 0x5A, 0xA5, 0x87, 0x6c
```

14）用户自定义全局灯效（0x0e）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x24, 0x0e, 0xFC, 0x5A, 0xA5, 0xc3, 0x6c
```

---

## 三、VIA改键（0x22）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x04 | 0x22 | Byte7~Byte9 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）将第一个按键改为A键
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x22, 0x01, 0x04, 0x00, 0xFC, 0x5A, 0xA5, 0x40, 0x12
```

2）将第十五个按键改为A键
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x22, 0x0f, 0x04, 0x00, 0xFC, 0x5A, 0xA5, 0x6e, 0x13
```

3）将第六十一个按键改为A键
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x22, 0x3d, 0x04, 0x00, 0xFC, 0x5A, 0xA5, 0x7c, 0x17
```

---

## 四、按键行程（0x23）

### 1、设置单个按键行程

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x03 | 0x23 | Byte7~Byte8 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）将第二个按键的键程设置为0.1MM
```
0xA5, 0x5A, 0xFC, 0x2E, 0x03, 0x23, 0x02, 0x01, 0xFC, 0x5A, 0xA5, 0x5f, 0x92
```

2）将第六十七个按键的键程设置为4.0MM
```
0xA5, 0x5A, 0xFC, 0x2E, 0x03, 0x23, 0x43, 0x28, 0xFC, 0x5A, 0xA5, 0x0C, 0xA6
```

### 2、设置全局按键行程

**数据格式（小端模式存储）：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x04 | 0x23 | Byte7~Byte9 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）将第一个按键的键程设置为0.03MM
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x23, 0x01, 0x03, 0x00, 0xFC, 0x5A, 0xA5, 0x40, 0xB7
```

2）将第六十一个按键的键程设置为4.0MM
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x23, 0x3D, 0x90, 0x01, 0xFC, 0x5A, 0xA5, 0x9D, 0x37
```

### 3、批量设置全局按键行程

**数据格式（0x51命令）：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x24 | 0x51 | Byte7~Byte41 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）设置第一包数据，按键1~34键程为0.2MM
```
0xa5, 0x5a, 0xfc, 0x2e, 0x24, 0x51, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0xfc, 0x5a, 0xa5, 0x19, 0x31
```

2）设置第二包数据，按键34~68键程为0.2MM
```
0xa5, 0x5a, 0xfc, 0x2e, 0x24, 0x51, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,
0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0xfc, 0x5a, 0xa5, 0x03, 0x81
```

---

## 五、校准（0x25/0x26/0x27）

### 1、清除已校准数据（0x25）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x03 | 0x25 | Byte7~Byte8 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）清除已校准的第三个按键
```
0xA5, 0x5A, 0xFC, 0x2E, 0x03, 0x25, 0x03, 0x01, 0xFC, 0x5A, 0xA5, 0xF9, 0xAF
```

2）清除已校准的第六十八个按键
```
0xA5, 0x5A, 0xFC, 0x2E, 0x03, 0x25, 0x44, 0x01, 0xFC, 0x5A, 0xA5, 0xF6, 0x1B
```

### 2、进入校准模式（0x26）

```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x26, 0x01, 0xFC, 0x5A, 0xA5, 0x17, 0x16
```

### 3、退出校准模式（0x27）

```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x27, 0x01, 0xFC, 0x5A, 0xA5, 0xd7, 0x2b
```

---

## 六、高级键（0x28）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x12 | 0x28 | Byte7~Byte23 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

### 1）讯洁模式（RS）

**RS模式命令解析：**
- Byte7：按键ID1（RS模式物理按键ID）
- Byte8：按键ID2（RS模式物理按键ID）
- Byte9：保留0
- Byte10：高级键模式（讯洁RS模式为0x01）
- Byte11：HID键值1（RS模式下需要比较的键值）
- Byte12：HID键值2（RS模式下需要比较的键值）
- Byte13~Byte23：保留0

**测试数据：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x09, 0x00, 0x01, 0x04, 0x05, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x01, 0xb1
```

### 2）瞬时释放模式（SOCD）

**SOCD模式命令解析：**
- Byte7：按键ID1（SOCD模式物理按键ID）
- Byte8：按键ID2（SOCD模式物理按键ID）
- Byte9：保留0
- Byte10：高级键模式（SOCD模式为0x02）
- Byte11：HID键值1（SOCD模式下的触发键值）
- Byte12：HID键值2（SOCD模式下的触发键值）
- Byte13~Byte14：保留0
- Byte15：设置SOCD覆盖方式
  - 0x10：后输入优先
  - 0x20：绝对优先"HID键值1"
  - 0x40：绝对优先"HID键值2"
  - 0x80：中立
- Byte16~Byte23：保留0

**测试数据：**

后输入优先（Byte15为0x10）：
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x09, 0x00, 0x02, 0x04, 0x05, 0x00, 0x00, 0x10, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x0E, 0x80
```

绝对优先"HID键值1"（Byte15为0x20）：
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x09, 0x00, 0x02, 0x04, 0x05, 0x00, 0x00, 0x20, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x4e, 0xc0
```

绝对优先"HID键值2"（Byte15为0x40）：
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x09, 0x00, 0x02, 0x04, 0x05, 0x00, 0x00, 0x40, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0xce, 0x40
```

中立（Byte15为0x80）：
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x09, 0x00, 0x02, 0x04, 0x05, 0x00, 0x00, 0x80, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x8f, 0x43
```

### 3）动态键程模式（DKS）

**DKS模式命令解析：**
- Byte7：按键ID1（DKS模式物理按键ID）
- Byte8：按键ID2（DKS模式物理按键ID）
- Byte9：保留0
- Byte10：高级键模式（DKS模式为0x03）
- Byte11：HID键值1（DKS模式下的触发键值）
- Byte12：HID键值2（DKS模式下的触发键值）
- Byte13：HID键值3（DKS模式下的触发键值）
- Byte14：HID键值4（DKS模式下的触发键值）
- Byte15：按压起始&完全抬起
- Byte16：按压触底&按压触底时抬起
- Byte17：单键触发（低四位对应KEYID1，高四位对应KEYID2）
- Byte18：单键触发（低四位对应KEYID3，高四位对应KEYID4）
- Byte19：KEYID1连续触发
- Byte20：KEYID2连续触发
- Byte21：KEYID3连续触发
- Byte22：KEYID4连续触发
- Byte23：Tick速率（0x01：无Tick速率；0x02：60Tick速率；0x03：30Tick速率）

**测试指令：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x00, 0x00, 0x03, 0x07, 0x05, 0x08, 0x09, 0x0a, 0x1e,
0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x01, 0xFC, 0x5A, 0xA5, 0xc7, 0x92
```

### 4）双效点击模式（MT）

**MT模式命令解析：**
- Byte7：按键ID1（MT模式物理按键ID）
- Byte8~Byte9：保留0
- Byte10：高级键模式（MT模式为0x04）
- Byte11：HID键值1（MT模式下的触发键值）
- Byte12：HID键值2（MT模式下的触发键值）
- Byte13~Byte16：保留0
- Byte17：手动调整按住时间10~1000ms（TIME High Byte）
- Byte18：手动调整按住时间10~1000ms（TIME LOW Byte）
- Byte19~Byte23：保留0

**测试数据（手动调整按住时间300ms）：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x00, 0x00, 0x04, 0x04, 0x05, 0x00, 0x00, 0x00, 0x00,
0x01, 0x2c, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0xc9, 0xe0
```

### 5）切换开关模式（TGL）

**TGL模式命令解析：**
- Byte7：按键ID1（TGL模式物理按键ID）
- Byte8~Byte9：保留0
- Byte10：高级键模式（TGL模式为0x05）
- Byte11：HID键值1（TGL模式下的触发键值）
- Byte12~Byte23：保留0

**测试数据：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x28, 0x08, 0x00, 0x00, 0x05, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x5e, 0xe9
```

### 高级键删除（0x37）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x12 | 0x37 | Byte7~Byte23 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x12, 0x37, 0x07, 0x00, 0x00, 0x05, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0xce, 0x50
```

---

## 七、用户自定义RGB灯光（0x29）

### 1、单个RGB灯光设置

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x05 | 0x29 | 键ID、R、G、B | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）将第一个按键灯光设置为红色
```
0xA5, 0x5A, 0xFC, 0x2E, 0x05, 0x29, 0x01, 0xFF, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x5D, 0xC8
```

2）将第二个按键灯光设置为白色
```
0xA5, 0x5A, 0xFC, 0x2E, 0x05, 0x29, 0x02, 0xFF, 0xFF, 0xFF, 0xFC, 0x5A, 0xA5, 0x5D, 0xDF
```

3）将第六十八个按键灯光设置为黄色
```
0xA5, 0x5A, 0xFC, 0x2E, 0x05, 0x29, 0x44, 0xFF, 0xFF, 0x00, 0xFC, 0x5A, 0xA5, 0x8D, 0xC8
```

4）关闭第六十八个按键的灯光
```
0xA5, 0x5A, 0xFC, 0x2E, 0x05, 0x29, 0x44, 0x00, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x96, 0xc8
```

### 2、用户自定义全局灯光设置（0x53）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x2F | 0x53 | 包ID、R、G、B... | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例（7包数据）：**

第一包数据：
```
0xA5, 0x5A, 0xFC, 0x2E, 0x2F, 0x53, 0x01, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff, ...
```

---

## 八、数据存储

### 1、设备端存储当前灯光模式（0x30）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x30, 0x01, 0xFC, 0x5A, 0xA5, 0xD4, 0x5F
```

### 2、设备端存储当前用户自定义灯光（0x31）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x31, 0x01, 0xFC, 0x5A, 0xA5, 0x14, 0x62
```

### 3、设备端存储当前用户自定义VIA改键（0x32）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x32, 0x01, 0xFC, 0x5A, 0xA5, 0x14, 0x26
```

### 4、设备端存储当前用户设置的按键行程（0x33）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x33, 0x01, 0xFC, 0x5A, 0xA5, 0xd4, 0x1b
```

### 5、设备端存储当前按键校准信息（0x34）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x34, 0x01, 0xFC, 0x5A, 0xA5, 0x14, 0xae
```

### 6、设备端存储当前已设置的高级键信息（0x35）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x35, 0x01, 0xFC, 0x5A, 0xA5, 0xD4, 0x93
```

### 7、设备端存储灯效亮度（0x36）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x36, 0x01, 0xFC, 0x5A, 0xA5, 0xD4, 0xD7
```

### 8、设备端存储当前用户自定义FN1层VIA改键（0x38）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x38, 0x01, 0xFC, 0x5A, 0xA5, 0x15, 0xbe
```

### 9、设备端存储当前自定义RGB全局灯光（0x39）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x39, 0x01, 0xFC, 0x5A, 0xA5, 0xD5, 0x83
```

---

## 九、数据读取

### 1、读取设备端当前RGB灯效模式（0x40）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x40, 0x01, 0xFC, 0x5A, 0xA5, 0x1f, 0x1e
```

**设备端返回数据：**
- 0x11：彩虹渐变
- 0x12：繁星点点
- 0x13：刀山火海
- 0x14：按键跟随
- 0x15：波涛汹涌
- 0x16：用户自定义RGB灯光
- 0x17：波浪
- 0x18：海浪渐变
- 0x19：跟随波浪
- 0x1a：大千世界
- 0x1b：彩虹呼吸
- 0x1c：默认灯效

### 2、读取设备端当前主Layout按键布局（0x41）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x41, 0x01, 0xFC, 0x5A, 0xA5, 0xDF, 0x23
```

读取第一包数据：
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x41, 0x10, 0xFC, 0x5A, 0xA5, 0xe3, 0x26
```

### 3、读取设备端当前键程设置（0x42）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x42, 0x01, 0xFC, 0x5A, 0xA5, 0xDF, 0x67
```

### 4、读取设备端当前按键校准状态（0x43）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x43, 0x01, 0xFC, 0x5A, 0xA5, 0x1F, 0x5A
```

### 5、读取设备端高级键（0x44）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x44, 0x01, 0xFC, 0x5A, 0xA5, 0xDF, 0xEF
```

### 6、读取设备端灯效亮度（0x61）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x61, 0x01, 0xFC, 0x5A, 0xA5, 0x18, 0xA2
```

### 7、读取设备端当前FN Layout按键布局（0x52）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x52, 0x01, 0xFC, 0x5A, 0xA5, 0x1c, 0xa6
```

### 8、读取设备当前工作模式（0x62）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x62, 0x01, 0xFC, 0x5A, 0xA5, 0x18, 0xe6
```

**设备回复：**
- 0x11：BOOT模式
- 0x12：系统工作模式

---

## 十、数据管理

### 1、恢复出厂设置（0x45）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x45, 0x01, 0xFC, 0x5A, 0xA5, 0x1F, 0xD2
```

### 2、重置键盘布局（0x46）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x46, 0x01, 0xFC, 0x5A, 0xA5, 0x1F, 0x96
```

### 3、清空所有高级键数据（0x47）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x47, 0x01, 0xFC, 0x5A, 0xA5, 0xDF, 0xAB
```

### 4、重置所有键程数据（0x48）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x48, 0x01, 0xFC, 0x5A, 0xA5, 0xDE, 0xFF
```

### 5、清除所有按键校准数据（0x49）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x49, 0x01, 0xFC, 0x5A, 0xA5, 0x1E, 0xC2
```

### 6、重置灯效模式（0x4C）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x4C, 0x01, 0xFC, 0x5A, 0xA5, 0x1e, 0x0e
```

### 7、清除用户自定义按键灯光（0x4D）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x4D, 0x01, 0xFC, 0x5A, 0xA5, 0xde, 0x33
```

### 8、重置RGB灯效亮度（0x4E）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x4E, 0x01, 0xFC, 0x5A, 0xA5, 0xde, 0x77
```

### 9、重置FN1层键盘布局（0x4F）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x4F, 0x01, 0xFC, 0x5A, 0xA5, 0x1e, 0x4a
```

---

## 十一、数据请求

### 1、请求设备端打开键程数据上报（0x4A）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x4A, 0x01, 0xFC, 0x5A, 0xA5, 0x1E, 0x86
```

### 2、请求设备端关闭键程数据上报（0x4B）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x4B, 0x01, 0xFC, 0x5A, 0xA5, 0xDE, 0xBB
```

### 3、请求设备端固件版本号（0x50）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x50, 0x01, 0xFC, 0x5A, 0xA5, 0xDC, 0xDF
```

---

## 十二、RGB灯效亮度调节（0x60）

**示例：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x60, 0x32, 0xFC, 0x5A, 0xA5, 0x9C, 0x90  // 设置亮度为50%
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x60, 0x64, 0xFC, 0x5A, 0xA5, 0x14, 0x81  // 设置亮度为100%
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x60, 0x0a, 0xFC, 0x5A, 0xA5, 0xfc, 0x9d  // 设置亮度为10%
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x60, 0x01, 0xFC, 0x5A, 0xA5, 0xd8, 0x9f  // 设置亮度为1%
```

---

## 十三、键盘配置（0x70）

**请求客户端下发云端配置：**

1）请求第一个配置
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x70, 0x01, 0xFC, 0x5A, 0xA5, 0x1b, 0x5e
```

2）请求第二个配置
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x70, 0x02, 0xFC, 0x5A, 0xA5, 0x5f, 0x5e
```

3）请求第三个配置
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x70, 0x03, 0xFC, 0x5A, 0xA5, 0xa3, 0x5f
```

4）请求第四个配置
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x70, 0x04, 0xFC, 0x5A, 0xA5, 0xd7, 0x5e
```

---

## 十四、FN层VIA改键（0x2A）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x04 | 0x2A | Byte7~Byte9 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例：**

1）将FN层第十五个按键改为A键
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x2A, 0x0f, 0x04, 0x00, 0xFC, 0x5A, 0xA5, 0xae, 0x9a
```

2）将FN层第十四个按键改为NULL
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x2A, 0x0e, 0xDE, 0x00, 0xFC, 0x5A, 0xA5, 0xAC, 0xC2
```

3）将第十四个键改为FN
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x22, 0x0E, 0xDF, 0x00, 0xFC, 0x5A, 0xA5, 0xAC, 0x76
```

---

## 十五、自定义按键

### 1、基本字符
USB HID协议文件中的Keyboard/Keypad Page (0x07)  
范围：0x00~0x27

### 2、扩展字符
USB HID协议文件中的Keyboard/Keypad Page (0x07)  
范围：0x28~0x65

### 3、媒体及音频控制
USB HID协议文件中的Consumer Page (0x0C)  
范围：0x00~0x023C

### 4、设备控制及配置切换键

**设备控制（范围：0x2000~0x2009）：**
- 0x2000 降低键盘亮度
- 0x2001 增加键盘亮度
- 0x2002 FN~FN1层之间切换
- 0x2004 灯效模式1
- 0x2005 灯效模式2
- 0x2006 灯效模式3
- 0x2007 流光速度减慢
- 0x2008 流光速度加快
- 0x2009 锁定WIN键

**配置切换（范围：0x3000~0x3005）：**
- 0x3000 PC端切换第一个配置
- 0x3001 PC端切换第二个配置
- 0x3002 PC端切换第三个配置
- 0x3003 PC端切换第四个配置
- 0x3004 PC Switch Mode（默认模式和最后使用的配置文件之间切换）
- 0x3005 PC Switch Cycle（循环切换所有激活的配置文件）

### 5、鼠标（范围：0x4000~0x4FFF）
- 0x4001 鼠标左键
- 0x4002 鼠标右键
- 0x4004 鼠标中键
- 0x4008 鼠标返回键
- 0x4010 鼠标前进键
- 0x4103 鼠标模拟左移（低7位可调，范围1~127，如0x4101~0x417f）
- 0x4203 鼠标模拟右移（低7位可调，范围1~127，如0x4201~0x427f）
- 0x4303 鼠标模拟上移（低7位可调，范围1~127，如0x4301~0x437f）
- 0x4403 鼠标模拟下移（低7位可调，范围1~127，如0x4401~0x447f）
- 0x4501 模拟向上滑动鼠标中键（低7位可调，范围1~127，如0x4501~0x457f）
- 0x4601 模拟向下滑动鼠标中键（低7位可调，范围1~127，如0x4601~0x467f）

### 6、特殊键值
- 无效键（0xDE）- 该键值可配合VIA改键命令使用
- FN键（0xDF）- 该键值可配合VIA改键命令使用

---

## 十六、IAP固件升级

### 一、设备进入IAP升级模式

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x04 | 0x2B | Byte7~Byte9 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x2B, 0x01, 0x00, 0x01, 0xFC, 0x5A, 0xA5, 0x7c, 0x7b
```

### 二、IAP数据传输模式

**数据格式：**

| 数据类型 | 数据长度 | 编程地址低字节 | 编程地址高字节 | 数据 |
|---------|---------|--------------|--------------|------|
| Byte1 | Byte2 | Byte3 | Byte4 | Byte5~N |

**1、开始IAP固件升级**
```
0x81 0x02 0x00 0x00
```

**2、传输数据**
```
第一包: 0x80 0x3c 0x00 0x00 Byte5~ByteN
第二包: 0x80 0x3c 0x3c 0x00 Byte5~ByteN
```

**3、校验数据**
```
第一包: 0x82 0x3c 0x00 0x00 Byte5~ByteN
```

**4、结束IAP固件升级**
```
0x83 0x02 0x00 0x00
```

> 注：数据传输过程中发生错误将返回"0x00 0x01"两个字节，"0x00 0x00"代表正确

---

## 十七、IAP固件升级（模式二）

### 一、设备进入IAP升级模式
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x2B, 0x01, 0x00, 0x01, 0xFC, 0x5A, 0xA5, 0x7c, 0x7b
```

### 二、固件升级

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 地址低 | 地址高 | 数据 | 尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|-------|-------|------|--------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | Byte5 | Byte6 | Byte7 | Byte8 | Byte9~N | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**1、开始IAP固件升级**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x03, 0x81, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x21, 0xf3
```

**2、传输数据**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x30, 0x80, 0x00, 0x00, Byte9~N, 0xFC, 0x5A, 0xA5, CRC16H, CRC16L
```

**3、校验数据**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x30, 0x82, 0x00, 0x00, Byte9~N, 0xFC, 0x5A, 0xA5, CRC16H, CRC16L
```

**4、结束IAP固件升级**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x03, 0x83, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0xC3, 0xF2
```

> 注：数据传输过程中发生错误将返回"0xff 0xff"两个字节

---

## 十八、按键实时监测

### 一、PC端主动向设备端同步时间戳（MS级）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 包头低 | 包头高 | 尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|--------|--------|--------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x07 | 0x67 | Byte7~9 | Byte10~12 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例（下发时间1761878483000，即2025-10-31 10:41:23）：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x07, 0x67, 0x38, 0x20, 0x24, 0x38, 0x9A, 0x01, 0xFC, 0x5A, 0xA5, 0xB3, 0xDC
```

### 二、PC端请求开启按键实时监测
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x63, 0x01, 0xFC, 0x5A, 0xA5, 0xD8, 0xDB
```

### 三、PC端请求关闭按键实时监测
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x64, 0x01, 0xFC, 0x5A, 0xA5, 0x18, 0x6E
```

### 四、PC端请求设备端上报按键实时监测数据总包数
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x65, 0x01, 0xFC, 0x5A, 0xA5, 0xD8, 0x53
```

### 五、PC端请求设备端上报按键实时监测数据
```
0xA5, 0x5A, 0xFC, 0x2E, 0x04, 0x66, 0x01, 0x00, 0x00, 0xFC, 0x5A, 0xA5, 0x84, 0xE7
```

---

## 十九、工厂按键校准及不良品检测PC端通讯协议

### 一、PC端向设备端发送进入工厂校准检测模式
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x68, 0x01, 0xFC, 0x5A, 0xA5, 0x19, 0x7E
```

### 二、PC端向设备端发送退出工厂校准检测模式
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x69, 0x01, 0xFC, 0x5A, 0xA5, 0xD9, 0x43
```

### 三、PC端请求设备端上报所有按键的最小AD采用值和最大AD采样值

**请求第1包数据：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x6A, 0x01, 0xFC, 0x5A, 0xA5, 0xD9, 0x07
```

**请求第2包数据：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x6A, 0x02, 0xFC, 0x5A, 0xA5, 0x9D, 0x07
```

**请求第3包数据：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x6A, 0x03, 0xFC, 0x5A, 0xA5, 0x61, 0x06
```

**请求第8包数据：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x6A, 0x08, 0xFC, 0x5A, 0xA5, 0x45, 0x04
```

### 四、PC端向设备端发送测试通过的SN设备序列号（0x6B）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x0A, 0x6B, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0xFC,
0x5A, 0xA5, 0x81, 0xDD
```

### 五、PC端向设备端发送测试未通过的SN设备序列号（0x6D）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x0A, 0x6D, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0xFC,
0x5A, 0xA5, 0x47, 0xD4
```

### 六、PC端向设备端请求SN设备序列号（0x6C）
```
0xA5, 0x5A, 0xFC, 0x2E, 0x02, 0x6C, 0x29, 0xFC, 0x5A, 0xA5, 0xD9, 0x8F
```

---

## 二十、MCU内部SPI音频按键提示音通讯协议

### 主机端发送声学定位角度及音源序号（0x6E）

**数据格式：**

| 数据帧头 | 帧头标志 | 数据类型 | 数据长度 | 数据命令 | 数据 | 帧尾标志 | 数据帧尾 | CRC16校验 |
|---------|---------|---------|---------|---------|------|---------|---------|----------|
| 0xA5、0x5A | 0xFC | 0x2E | 0x03 | 0x6E | Byte7~Byte8 | 0xFC | 0x5A、0xA5 | CRC16H、CRC16L |

**示例（-90度左侧扬声器发声，序号1）：**
```
0xA5, 0x5A, 0xFC, 0x2E, 0x03, 0x6E, 0xA6, 0x01, 0xFC, 0x5A, 0xA5, 0x5B, 0xEC
```

---

## 二十一、CRC16校验核心代码

```c
uint16_t crc16_get_value(uint8_t *message, uint16_t len)
{
    uint16_t i, j;
    uint16_t crc_value = 0xffff;
    
    for(i = 0; i < len; i++)
    {
        crc_value ^= *message++;
        for(j = 0; j < 8; j++)
        {
            if(crc_value & 0x0001)
            {
                crc_value = crc_value >> 1 ^ 0xA001;
            }
            else
            {
                crc_value >>= 1;
            }
        }
    }
    return(crc_value);
}
```

---

*文档版本：V1.0.0*  
*深圳市灰鲨科技有限公司 研发部硬件组*
